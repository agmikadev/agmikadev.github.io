/* --- 1. DEFINE THE ANGLE PROPERTY --- */
@property --angle {
  syntax: "<angle>";
  initial-value: 0deg;
  inherits: false;
}

/* --- 2. THE SYSTEM CONTAINER (The "Parent") --- */
.system-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  z-index: 3;

  /* ESSENTIAL: Defines the container for the scale query */
  container-type: inline-size;
  min-width: 300px; /* Safety fallback */
}

/* --- 3. THE SEED VALUE --- */
/* Elements inside calculate their size based on the container width */
.central-star,
.orbit-group {
  --scale: calc(100cqw / 650);
}

/* --- 4. THE STAR --- */
.central-star {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: auto;

  width: calc(48 * var(--scale));
  height: calc(48 * var(--scale));

  background: radial-gradient(circle, #fff 0%, #ffdf00 60%);
  border-radius: 50%;
  box-shadow:
    0 0 28px #ffdf00,
    0 0 45px #ffdf0040;

  z-index: 1000;
  animation: star-pulse 4s ease-in-out infinite;
}

/* --- 5. THE GROUP CONTAINER --- */
.orbit-group {
  position: absolute;
  top: 50%;
  left: 50%;
}

/* --- 6. THE VISUAL RING --- */
.orbit-ring {
  position: absolute;
  top: 50%;
  left: 50%;

  width: calc(var(--radius) * 2 * var(--scale));
  height: calc(var(--radius) * 2 * var(--scale));

  border: 1px dashed rgba(100, 100, 255, 0.2);
  border-radius: 50%;

  /* 65-degree 3D perspective squish */
  transform: translate(-50%, -50%) scaleY(0.4226);
  pointer-events: none;
}

/* --- 7. THE PLANET LINK (The Invisible Anchor) --- */
.planet-link {
  position: absolute;
  top: 50%;
  left: 50%;

  /* Force the button to be a 0x0 point */
  width: 0;
  height: 0;
  display: block; /* Removed flexbox */

  text-decoration: none;
  cursor: pointer;
  background: none;
  border: none;
  padding: 0;
  outline: none;
  -webkit-tap-highlight-color: transparent;

  perspective: 1000px;
  transform-style: preserve-3d;

  animation: orbit var(--speed) linear infinite;
  z-index: round(calc(sin(var(--angle)) * var(--r-val) + 1000), 1);

  transform: translate(
    calc(cos(var(--angle)) * var(--radius) * var(--scale) - 50%),
    calc(sin(var(--angle)) * var(--radius) * var(--scale) * 0.4226 - 50%)
  );
}

/* --- 9. THE LABEL --- */
.planet-label {
  position: absolute;
  
  /* 1. X-AXIS: Start at the exact center of the 0x0 button */
  left: 50%; 
  
  /* 2. Y-AXIS (THE GAP): Pushes the label up from the center.
     Hover Radius (Size * Scale * 0.65) + 12px for the outer glow.
     Using margin makes it 100% immune to the 3D scale bug! 
  */
  bottom: calc((var(--p-size) + 4) * var(--scale));
  
  background-color: var(--p-color); 
  color: #fff; 
  padding: 4px 11px 4px 12px; 
  border-radius: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.6), 0 0 15px var(--p-color); 
  
  font-size: clamp(0.7rem, 2cqw, 1rem); 
  font-family: monospace;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  white-space: nowrap; 
  
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;

  /* 3. THE 3D SCALE & X-CENTERING:
     Anchored at bottom center.
     translateX(-50%) pulls it perfectly over the planet.
     Scale ONLY affects the size, not the gap.
  */
  transform-origin: bottom center;
  transform: translateX(-50%) scale(calc(1 + sin(var(--angle)) * 0.35));
}

/* --- 10. KEYFRAMES --- */
@keyframes orbit {
  from {
    --angle: 0deg;
  }
  to {
    --angle: 360deg;
  }
}

@keyframes star-pulse {
  0%,
  100% {
    transform: scale(1);
    box-shadow:
      0 0 28px #ffdf00,
      0 0 45px #ffdf0040;
  }
  50% {
    transform: scale(1.05);
    box-shadow:
      0 0 25px #ffdf00,
      0 0 55px #ffdf0060;
  }
}

/* --- 11. HOVER EFFECTS --- */
.planet-link:hover {
  animation-play-state: paused;
  z-index: 9999;
}

/* Only the planet scales, keeping its center. The label sibling is immune! */
.planet-link:hover .planet {
  transform: translate(-50%, -50%) scale(1.3);
}

.planet-link:hover .planet-label {
  opacity: 1;
}
